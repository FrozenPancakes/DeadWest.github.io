<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dead West</title>
  <link rel="stylesheet" href="https://pyscript.net/releases/2025.5.1/core.css">
  <script type="module" src="https://pyscript.net/releases/2025.5.1/core.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rye&display=swap'); 

    body {
      background-color: #000;
      margin: 0;
      padding: 20px;
    }

    #console {
      color: #fff;
      white-space: pre-wrap;
      font-family: 'Rye', cursive;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div id="console"></div>

  <py-script>
    from js import document, window
    from pyodide.ffi import create_proxy
    import asyncio
    import random 

    console = document.getElementById("console")

    printlist = []
    health = None
    detectpresses = True
    waitingforstructureinput = False
    temp = None
    temp2 = None

    def reprint():
        console.innerHTML = "\n".join(printlist)

    def _print(text):
        printlist.append(text)
        reprint()

    async def game_loop(): 
          global temp, waitingforstructureinput, temp2, health

          _print("Dead West lol")
          _print("")
          _print("health")
          _print("fuel")
          _print("distance")

          items = [

          ]

          basicstructures = [
            {"name": "Abandoned House", "possibleloot": ["rock", "stick", "silver"]},
            {"name": "Abandoned Farm", "possibleloot": ["rock", "stick", "wood planks"]},
            {"name": "Abandoned Clinic", "possibleloot": ["bandage"]}
          ]

          inventory = [

          ]

          fuel = 10
          distance = 1 
          health = 100
          
          structuredistance = random.randint(10,20)/10
          structurenumber = random.randint(0,len(basicstructures))-1
          nextstructure = basicstructures[structurenumber]["name"]
          
          def damage(damage):
            global health, printlist
            health -= damage 
            printlist[2] = f"Health: {health}"
            reprint()
          
          def clearbelowmain():
            global printlist
            printlist = printlist[:5]
            reprint()

          while True:
            if len(printlist) > 2:
                printlist[2] = f"Health: {health}"
            if len(printlist) > 3:
                printlist[3] = f"Fuel: {fuel:.3f}"
            if len(printlist) > 4:
                printlist[4] = f"Distance: {distance:.3f} km" 

            if fuel >= 0:
              distance += 0.025
              fuel -= 0.025

            reprint()

            if distance >= structuredistance:
              _print(" ")
              _print(f"Raid {nextstructure} ? [y/n]")
              waitingforstructureinput = True 

              while waitingforstructureinput:
                await asyncio.sleep(0.1)
              
              await asyncio.sleep(2)

              clearbelowmain()

              reprint()

              rng = random.randint(1,3)

              if temp == "raid":
                if rng > 1:
                  _print("")
                  _print(f"You spot a zombie and it looks hungry.")
                  _print("Do you flee? [y/n]")
                  temp = True 
                  while temp:
                    await asyncio.sleep(0.1)

                  clearbelowmain()

                  if temp2 == "flee":
                    damage(5)
                    clearbelowmain()

                  elif temp2 == "stay":
                    _print("")
                    if random.randint(1,2) == 1:
                      rng = random.randint(1,3)
                      if rng == 1:
                        _print("you violently smack the zombie to death.")
                      elif rng == 2:
                        _print("you bonk the zombie in the head with your crowbar and it collapses")
                      else:
                        _print("you sub2ades at @adesertpolice and it dies from seeing something so cool.")
                    else: 
                      _print("The zombie mauls you and then in self defense you hit the zombie to death")
                      damage(random.randint(3,6))
                    
                    await asyncio.sleep(2)
                    clearbelowmain()

                    _print("you see the following objects in the room:")
                    for i, in range(len(basicstructures[structurenumber]["possibleloot"])):
                      _print(basicstructures[i - 1]["name"])

                    await asyncio.sleep(2)
                    clearbelowmain()

                else:
                  _print("you see the following objects in the room:")
                  for i, in range(len(basicstructures[structurenumber]["possibleloot"])):
                    _print(basicstructures[i - 1]["name"])

                  await asyncio.sleep(2)
                  clearbelowmain()

              structuredistance += random.randint(10,20)/10


            await asyncio.sleep(0.6)

    async def log_key(event):
        global printlist, detectpresses, distance, waitingforstructureinput, temp, temp2

        key = event.key

        if key == "y" and detectpresses:
            printlist.clear()
            _print("When fleeing it takes 3 HP")
            _print("1 Tick of Fuel = 1km of distance")
            _print("")
            _print("press [n] to start the game")

        elif key == "n" and detectpresses:
            detectpresses = False  
            printlist.clear()
            await game_loop()

        elif waitingforstructureinput == True:
          if key == "y":
            _print("")
            _print("You choose to raid it!")
            
            temp = "raid"

            waitingforstructureinput = False
          elif key == "n":
            _print("")
            _print("You choose not to raid it.")
            waitingforstructureinput = False

            temp = "notraid"

        elif temp == True:
          if key == "y":
            _print("")
            _print("You fled! -5 HP.")
            temp = False
            temp2 = "flee"
          elif key == "n":
            temp = False
            temp2 = "stay"

        elif temp = "items":
          if key == "1":
          if key == "2":
          if key == "3":
          if key == "4":
          if key == "5":
          if key == "6":
          if key == "7":
          if key == "8":
          if key == "9":
          if key == "0":

        console.scrollTop = console.scrollHeight

    def log_key_wrapper(event):
        asyncio.ensure_future(log_key(event))

    log_key_proxy = create_proxy(log_key_wrapper)
    window.addEventListener("keydown", log_key_proxy)

    _print("DEAD WEST")
    _print("Welcome to the Game")
    _print("be sure to sub 2 ades!!!")
    _print("if you don't i will steal ur kneecaps")
    _print(" ")

    _print("The year is 1884, the World has been taken over by a Zombie Apocalypse...")
    _print("The only safe spot is in Mexico exactly 100km away.")
    _print("You must reach it by train, but all the drivers are zombies.")
    _print("You're on your own. Good luck.")
    _print(" ")

    _print("HOW TO PLAY")
    _print("Goal: Reach 50km.")
    _print("Raid houses/cities to gather and sell items.")
    _print("You carry a crowbar and have a sack that holds 25kg.")
    _print("Add coal to the train furnace to travel.")
    _print(" ")

    _print("Type [y] to see Complex Instructions or [n] to Start Playing!!") 
  </py-script>
</body>
</html>
