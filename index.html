<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dead West</title>
  <link rel="stylesheet" href="https://pyscript.net/releases/2025.5.1/core.css">
  <script type="module" src="https://pyscript.net/releases/2025.5.1/core.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rye&display=swap'); 

    body {
      background-color: #000;
      margin: 0;
      padding: 20px;
    }

    #console {
      color: #fff;
      white-space: pre-wrap;
      font-family: 'Rye', cursive;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div id="console"></div>

  <py-script>
    from js import document, window
    from pyodide.ffi import create_proxy
    import asyncio

    console = document.getElementById("console")

    printlist = []
    detectpresses = True

    def reprint():
        console.innerHTML = "\n".join(printlist)

    def _print(text):
        printlist.append(text)
        reprint()

    async def game_loop(): 

          _print("Dead West lol")
          _print(" ")
          _print("distance")
          _print("health")

          basicstructures = [
            {"name": "Abandoned House", "possibleloot": ["rock", "stick", "silver"]},
            {"name": "Abandoned Farm", "possibleloot": ["common", "rare"]},
            {"name": "Abandoned Clinic", "possibleloot": ["common", "rare", "epic", "legendary"]}
          ]

          distance = 0 
          health = 100

          while True:
            if len(printlist) > 2:
                printlist[2] = f"Health: {health}"
            if len(printlist) > 3:
                printlist[3] = f"Distance: {distance} km"            
            distance += 100
            reprint()

            await asyncio.sleep(0.6)

    async def log_key(event):
        global gameState, printlist, detectpresses, distance

        key = event.key

        if key == "y" and detectpresses:
            printlist.clear()
            _print("When fleeing it is a 1/2 Chance of succeeding and takes 3 HP")
            _print("1 Tick of Fuel = 25m of distance")
            _print("")
            _print("press [n] to start the game")

        elif key == "n" and detectpresses:
            detectpresses = False  
            printlist.clear()
            await game_loop()

        console.scrollTop = console.scrollHeight

    # Sync wrapper to run the async log_key function
    def log_key_wrapper(event):
        asyncio.ensure_future(log_key(event))

    log_key_proxy = create_proxy(log_key_wrapper)
    window.addEventListener("keydown", log_key_proxy)

    # Initial screen
    _print("DEAD WEST")
    _print("Welcome to the Game")
    _print("be sure to sub 2 ades!!!")
    _print("if you don't i will steal ur kneecaps")
    _print(" ")

    _print("The year is 1884, the World has been taken over by a Zombie Apocalypse...")
    _print("The only safe spot is in Mexico exactly 100km away.")
    _print("You must reach it by train, but all the drivers are zombies.")
    _print("You're on your own. Good luck.")
    _print(" ")

    _print("HOW TO PLAY")
    _print("Goal: Reach 100km.")
    _print("Raid houses/cities to gather and sell items.")
    _print("You carry a crowbar and have a sack that holds 25kg.")
    _print("Add coal to the train furnace to travel.")
    _print(" ")

    _print("Type [y] to see Complex Instructions or [n] to Start Playing!!") 
  </py-script>
</body>
</html>
